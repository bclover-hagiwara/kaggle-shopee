# 【kaggle】Shopee - Price Match Guarantee

## Overview by DeepL
**Description by DeepL** <br>
あなたは、お得な情報を求めてオンラインショップをチェックしていますか？同じ商品を買うのに、店によって値段が違うのは嫌だと思う人は多いでしょう。小売企業は、自社の商品が最も安いことをお客様に保証するために、さまざまな方法を用いています。中でも、他の小売店で販売されている商品と同等の価格で商品を提供する「プロダクトマッチング」という手法があります。このマッチングを自動的に行うには、徹底した機械学習のアプローチが必要であり、データサイエンスのスキルが役立ちます。

似たような商品の2つの異なる画像は、同じ商品を表している場合もあれば、全く別の商品を表している場合もあります。小売業者は、2つの異なる商品を混同してしまうことで生じる誤表示などの問題を避けたいと考えています。現在は、ディープラーニングと従来の機械学習を組み合わせて、画像やテキストの情報を解析し、類似性を比較しています。しかし、画像やタイトル、商品説明などに大きな違いがあるため、これらの方法は完全には有効ではありません。

Shopeeは、東南アジアと台湾における主要なEコマースプラットフォームです。お客様は、それぞれの地域に合わせた、簡単で安全かつ迅速なオンラインショッピング体験を高く評価しています。また、Shopeeに掲載されている何千もの商品に対して「最低価格保証」機能を提供するとともに、支払いや物流に関する強力なサポートを提供しています。

このコンペティションでは、機械学習のスキルを応用して、どのアイテムが同じ商品であるかを予測するモデルを構築します。

その応用範囲は、Shopeeや他の小売業者をはるかに超えています。商品のマッチングに貢献することで、より正確な商品分類をサポートし、マーケットプレイスのスパムを発見することができます。顧客は、買い物をする際に、同じ商品や似たような商品がより正確にリストアップされることで利益を得ることができます。そして最も重要なことは、あなたやあなたの周りの人たちがお得な商品を探すのに役立つということです。

**Evaluation by DeepL** <br>
サブミットは，F1スコアの平均値に基づいて評価されます。平均値はサンプルワイズ方式で計算されます。つまり、予測されたすべての行についてF1スコアを計算し、それを平均します。

Submission File
`posted_id` の投稿と一致するすべての `posted_id` をスペースで区切ったリストを作成する必要があります。投稿は常にセルフマッチとなります。グループサイズの上限は50なので、50以上のマッチを予測してもメリットはありません。
ファイルはヘッダーを持ち、submission.csvという名前で、以下のような形にしてください。
```
posting_id,matches
test_123,test_123
test_456,test_456 test_789
```

**shopee とは** <br>
インドネシアやマレーシア、台湾、フィリピンで展開されている EC サイト。これらの地域では、Amazon が進出していないため、shopee が活用されている。どうやら、インドネシアがメインのマーケット。

## Data by DeepL
[train/test].csv - トレーニングセットのメタデータです。各行には、1つの投稿のデータが含まれています。複数の投稿は、画像IDが全く同じでもタイトルが違ったり、その逆の場合もあります。
* `posting_id` - 投稿のIDコードです。
* `image` - 画像のID/md5sumです。
* `image_phash` - 画像のパーセプチュアルハッシュです。
* `title` - 投稿の商品説明です。
* `label_group` - 同じ商品に対応するすべての投稿のIDコード。テストセットでは提供されていません。

[train/test]images - 投稿に関連する画像。

sample_submission.csv - 正しいフォーマットのサンプル投稿ファイルです。
* `posting_id` - 投稿物のIDコードです。
* `matches` - この投稿にマッチするすべての投稿IDのスペース区切りのリストです。投稿は常にセルフマッチします。グループサイズの上限は50なので、50以上のマッチを予測する必要はありません。

**More Detail** <br>
|columns|Explanation|
|----|----|
|`posting_id`|train.csv の各行に対してユニークに割り当てられている. 画像やタイトルに対してユニークに割り当てられているわけではない|
|`image`|画像の path を表しているが、異なる path でも同一の画像が存在している。（phash からわかる）|
|`image_phash`|画像ごとに固有に割り当てられたハッシュ値。ハミング距離でその類似度を求めることができ、同一画像だとハミング距離は 0 になる。似ている画像では近い値になることから、画像間の類似度を求めることができる。`phash` は同じだが `image` が異なるケースがある|
|`title`|タイトルは同じだが、画像が異なることがある（`posting_id` は異なるが `title` が同じケースがある）|
|`label_group`|`label_group` が表す同じ評品とは `posting_id` が同じものを指すわけではなく、コンテンツが同じという意（ex. label_group: A --> タワシ）

Detail より、`posting_id` は画像（`iamge`）と `title` の組み合わせに対してユニークに振り当てられていることがわかる。このことから、画像または文字列だけでのマッチングは不可能であり、両方を加味できるモデルを用意する必要がある。

## ToDo
- [] タイトルが同じ同士の画像を確認する。phash が同じ画像同士のタイトルを比較する
- [] [この NB](https://www.kaggle.com/zzy990106/b0-bert-cv0-9) を参考にして EfficientNet と BERT or Transformer でベースラインを用意する
- [] CV 戦略を検討する

## Ideas
 * (3/15) phash の数を特徴量として利用できないか？
 * (3/15) タイトルとタイトルに含まれる単語の出現回数を合わせて特徴として利用できないか？
 * (3/15) ハミング距離を特徴量として利用できないか？

 ## Kaggle Diary
 ### 2021-3-16
 * 上記の内容についてまとめ
 * perceptual hash について整理して、`perceptual_hash.ipynb` にまとめた
 * 簡易的な EDA より、ideas を整理